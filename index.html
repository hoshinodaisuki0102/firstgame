<canvas id="gameCanvas"></canvas>
<div id="ui">
  <div class="dashContainer">
    <div id="dashBar"></div>
    <span id="dashText">DASH READY</span>
  </div>
</div>

<style>
  body, html {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: black;
  }
  #gameCanvas {
    display: block;
  }
  #ui {
    position: absolute;
    bottom: 20px;
    left: 20px;
    font-family: "Press Start 2P", monospace;
  }
  .dashContainer {
    position: relative;
    width: 200px;
    height: 25px;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid white;
    border-radius: 6px;
    overflow: hidden;
  }
  #dashBar {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    background: linear-gradient(90deg, #ff4444, #ff8888);
    width: 100%;
    transition: width 0.2s linear;
  }
  #dashText {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-size: 12px;
    text-shadow: 1px 1px 2px black;
  }
</style>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const bgImg = new Image();
bgImg.src = "abydos.jpg";

const frames = [
  new Image(),
  new Image(),
  new Image(),
  new Image()
];
frames[0].src = "hoshino_move1.png";
frames[1].src = "hoshino_move2.png";
frames[2].src = "hoshino_move3.png";
frames[3].src = "hoshino_move4.png";

let player = {
  x: 200, y: 0,
  width: 80, height: 80,
  vx: 0, vy: 0,
  speed: 4,
  jumping: false,
  frame: 0,
  moving: false
};

const animOrder = [0, 1, 2, 0, 1, 3]; 
let animIndex = 0;
let animTimer = 0;
const animSpeed = 150;

const gravity = 0.6;
const groundLevel = canvas.height - 120;

let keys = {};

let dashCooldown = 10000; // 10ì´ˆ
let lastDashTime = -dashCooldown; 
let dashReady = true;

const dashBar = document.getElementById("dashBar");
const dashText = document.getElementById("dashText");

function updateDashUI() {
  const now = Date.now();
  const timeSinceDash = now - lastDashTime;
  if (timeSinceDash >= dashCooldown) {
    dashBar.style.width = "100%";
    dashText.innerText = "DASH READY";
    dashReady = true;
  } else {
    const remaining = Math.ceil((dashCooldown - timeSinceDash) / 1000);
    const percent = (timeSinceDash / dashCooldown) * 100;
    dashBar.style.width = percent + "%";
    dashText.innerText = `DASH (${remaining}s)`;
    dashReady = false;
  }
}

function handleInput() {
  player.moving = false;
  if (keys["ArrowLeft"] || keys["a"]) {
    player.vx = -player.speed;
    player.moving = true;
  } else if (keys["ArrowRight"] || keys["d"]) {
    player.vx = player.speed;
    player.moving = true;
  } else {
    player.vx = 0;
  }

  if ((keys["ArrowUp"] || keys["w"] || keys[" "]) && !player.jumping) {
    player.vy = -12;
    player.jumping = true;
  }

  if (keys["f"] && dashReady) {
    player.vx *= 3; 
    lastDashTime = Date.now();
  }
}

function updatePlayer(deltaTime) {
  handleInput();

  player.vy += gravity;
  player.x += player.vx;
  player.y += player.vy;

  if (player.y + player.height > groundLevel) {
    player.y = groundLevel - player.height;
    player.vy = 0;
    player.jumping = false;
  }
  
  if (player.moving) {
    animTimer += deltaTime;
    if (animTimer > animSpeed) {
      animTimer = 0;
      animIndex = (animIndex + 1) % animOrder.length;
      player.frame = animOrder[animIndex];
    }
  } else {
    player.frame = 0;
    animIndex = 0;
  }
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.drawImage(bgImg, 0, 0, canvas.width, canvas.height);
  ctx.drawImage(frames[player.frame], player.x, player.y, player.width, player.height);
}

let lastTime = 0;
function gameLoop(timestamp) {
  const deltaTime = timestamp - lastTime;
  lastTime = timestamp;

  updatePlayer(deltaTime);
  updateDashUI();
  draw();

  requestAnimationFrame(gameLoop);
}

window.addEventListener("keydown", e => keys[e.key] = true);
window.addEventListener("keyup", e => keys[e.key] = false);

gameLoop();
</script>
